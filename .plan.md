# Navigation Enhancement Plan

> Future vision for hierarchical diary navigation with calendar widgets and rich metadata displays.

## Current State

The frontend already has a solid foundation:
- **Year grid** → `/cz/` shows all years with translation progress
- **Carnet lists** → `/cz/{year}/` shows carnets in that year
- **Entry lists** → `/cz/{carnet}/` shows all entries in a carnet
- **Entry view** → `/cz/{carnet}/{entry}` shows the actual diary text

**Data already available in frontmatter:**
- `date`, `carnet`, `location`
- `people[]`, `places[]`, `themes[]`
- `para_start` (sequential paragraph numbering)

---

## Vision

### 1. Year Overview (Expandable)

**Current:** Grid of year cards with basic stats.

**Enhanced:**
```
┌─────────────────────────────────────────────────────┐
│  1873                                    Marie: 14  │
│  ─────────────────────────────────────────────────  │
│  Carnets: 001, 002, 003, 004              ▼ expand  │
│  Entries: 127 │ Translated: 89 (70%)                │
│  Locations: Nice, Rome, Naples, Paris               │
└─────────────────────────────────────────────────────┘

▼ Expanded:
┌─────────────────────────────────────────────────────┐
│  Carnet 001    Jan 11 – Feb 12    Nice              │
│  Carnet 002    Feb 16 – Mar 12    Nice → Rome       │
│  Carnet 003    Mar 13 – Apr 14    Rome              │
│  Carnet 004    Apr 15 – May 17    Rome → Naples     │
└─────────────────────────────────────────────────────┘
```

**Data needs:**
- Aggregate locations per year (from entry frontmatter)
- Carnet summaries with date ranges and location journeys

---

### 2. Carnet Summary View (Clickable Cards)

**Current:** Simple list of entry dates.

**Enhanced:** Rich carnet card with summary panel + calendar widget.

```
┌─────────────────────────────────────────────────────────────────┐
│  Carnet 001: Nice, janvier–février 1873                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  SUMMARY                           │  CALENDAR                  │
│  ─────────                         │  ─────────                 │
│  25 entries                        │       January 1873         │
│  Jan 11 – Feb 12, 1873             │  M  T  W  T  F  S  S       │
│                                    │        1  2  3  4  5       │
│  LOCATIONS                         │  6  7  8  9 10 ⬤ 12       │
│  • Nice (primary)                  │ 13 ⬤ ⬤ ⬤ 16 17 ⬤       │
│  • Promenade des Anglais           │ ⬤ ⬤ 21 22 23 ⬤ 25       │
│  • Opéra de Nice                   │ ⬤ 27 28 ⬤ ⬤ 31          │
│                                    │                            │
│  KEY PEOPLE                        │       February 1873        │
│  • Duke of Hamilton ████████ 18    │  M  T  W  T  F  S  S       │
│  • Paul de Cassagnac ████ 9        │              ⬤  ⬤         │
│  • Dina ███ 7                      │  3  4  ⬤  ⬤  ⬤  ⬤  ⬤    │
│                                    │ ⬤ ⬤ 12                    │
│  THEMES                            │                            │
│  romantic_obsession, society,      │  ⬤ = has entry            │
│  opera, fashion                    │                            │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  EDITORIAL SUMMARY (from carnet summary file)                   │
│  ─────────────────                                              │
│  Marie begins the first carnet of her diary while staying in    │
│  Nice with her mother. She becomes infatuated with the Duke of  │
│  Hamilton, whom she observes at the Promenade and the opera...  │
└─────────────────────────────────────────────────────────────────┘
```

**Calendar widget features:**
- Month grid(s) covering carnet's date range
- Days with entries are highlighted/clickable
- Click → jump to that entry
- Visual density shows writing patterns

**Data needs:**
- Aggregated `people[]` with frequency counts
- Aggregated `places[]` with categorization
- Aggregated `themes[]`
- **NEW:** Carnet summary file with editorial commentary

---

### 3. Carnet Summary Files

**Proposed location:** `src/_original/{carnet}/_summary.md`

**Format:**
```yaml
---
carnet: "001"
title: "Nice, janvier–février 1873"
date_range:
  start: 1873-01-11
  end: 1873-02-12
primary_location: Nice
location_journey: ["Nice"]  # or ["Nice", "Rome"] for travel carnets

key_people:
  - id: DUKE_OF_HAMILTON
    role: romantic_obsession
  - id: PAUL_DE_CASSAGNAC
    role: admired_politician
  - id: DINA
    role: confidante

major_themes:
  - romantic_obsession
  - society_life
  - opera

marie_age: 14
---

## Editorial Summary

Marie begins the first carnet of her diary while staying in Nice
with her mother and aunt Sophie. She becomes infatuated with the
Duke of Hamilton, whom she observes obsessively at the Promenade
des Anglais and at the opera...

## Historical Context

Nice in 1873 was a fashionable winter resort for European
aristocracy. The Promenade des Anglais was the social hub...

## Reading Notes

This carnet establishes many of Marie's characteristic patterns:
her dramatic declarations of love, her sharp social observations,
and her ambition disguised as fatalism...
```

**Benefits:**
- Human-curated summaries (not just aggregated data)
- Editorial guidance for readers
- Historical context per carnet
- Can be expanded over time

---

### 4. Daily Entry View (Calendar Context)

**Current:** Entry text with prev/next navigation.

**Enhanced:** Collapsible calendar sidebar showing current month.

```
┌─────────────────────────────────────────────────────────────────┐
│  ◀ prev │ Carnet 001 › Samedi 11 janvier 1873 │ next ▶         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────────┐                                           │
│  │   January 1873   │  ◀ collapse                               │
│  │ M  T  W  T  F  S │                                           │
│  │       1  2  3  4 │                                           │
│  │ 6  7  8  9 10[11]│  ← current entry                          │
│  │13 14 15 16 17 18 │                                           │
│  │19 20 21 22 23 24 │                                           │
│  │26 27 28 29 30 31 │                                           │
│  └──────────────────┘                                           │
│                                                                 │
│  %% 001.0001 %%                                                 │
│  Carnet N° 1                                                    │
│                                                                 │
│  %% 001.0002 %%                                                 │
│  Les Howard étaient venus me chercher pour aller à la           │
│  promenade...                                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Features:**
- Shows current month with entry days highlighted
- Current entry's date is boxed/selected
- Click any highlighted day → navigate to that entry
- Collapsible to save space
- Remembers collapse state in localStorage

---

## Implementation Phases

### Phase 1: Calendar Widget Component

**New component:** `CalendarWidget.vue`

```typescript
interface CalendarWidgetProps {
  // What to display
  year: number;
  month: number;  // 1-12

  // Which days have entries (clickable)
  entryDays: number[];

  // Current selection (if any)
  selectedDay?: number;

  // Navigation
  onDayClick: (day: number) => void;

  // Styling
  compact?: boolean;  // For entry sidebar
}
```

**Variants:**
- `compact` - Single month, minimal chrome (for entry view)
- `full` - Multiple months, navigation arrows (for carnet view)

---

### Phase 2: Carnet Summary Infrastructure

1. **Create summary file schema** (TypeScript interface)
2. **Add loader function:** `getCarnetSummary(carnet, language)`
3. **Create initial summary files** for completed carnets
4. **Aggregate data function:** Auto-generate people/places/themes counts from entries

```typescript
interface CarnetSummary {
  carnet: string;
  title: string;
  dateRange: { start: Date; end: Date };
  primaryLocation: string;
  locationJourney: string[];

  // Aggregated from entries
  entryDates: string[];  // For calendar
  peopleCounts: Map<string, number>;
  placesCounts: Map<string, number>;
  themeCounts: Map<string, number>;

  // Editorial (from _summary.md)
  editorialSummary?: string;
  historicalContext?: string;
  readingNotes?: string;
  keyPeople?: { id: string; role: string }[];
}
```

---

### Phase 3: Enhanced Carnet View

1. **Update `/cz/{carnet}/index.astro`:**
   - Load carnet summary
   - Render calendar widget(s) for date range
   - Show aggregated metadata panels
   - Display editorial summary if available

2. **Design decision:** Separate panels vs. unified card

---

### Phase 4: Year View Expansion

1. **Add expand/collapse state** to year cards
2. **Carnet mini-cards** inside expanded year
3. **Aggregate year-level stats:**
   - All locations visited
   - Top people mentioned
   - Major themes

---

### Phase 5: Entry View Calendar

1. **Add collapsible calendar sidebar** to entry pages
2. **Sync with BookSidebar** (existing left nav)
3. **Mobile:** Calendar in hamburger menu or swipe gesture

---

## Data Aggregation Strategy

**Option A: Build-time aggregation**
- Generate JSON during Astro build
- Pro: Fast page loads
- Con: Requires rebuild for changes

**Option B: Runtime aggregation**
- Compute on page load
- Pro: Always fresh
- Con: Slower initial load

**Option C: Hybrid (Recommended)**
- Pre-compute during build → `/_data/carnet-summaries.json`
- Editorial content stays in `_summary.md` files
- Runtime only loads pre-computed JSON

```typescript
// Build script: scripts/generate-carnet-summaries.ts
async function generateCarnetSummaries() {
  const carnets = await getCarnets('_original');
  const summaries: CarnetSummaryData[] = [];

  for (const carnet of carnets) {
    const entries = await getCarnetEntries(carnet.id, '_original');
    const dates: string[] = [];
    const people = new Map<string, number>();
    const places = new Map<string, number>();
    const themes = new Map<string, number>();

    for (const entryId of entries) {
      const entry = await getEntry(carnet.id, entryId, '_original');
      dates.push(entry.date);

      // Count people mentions
      for (const person of entry.frontmatter.people || []) {
        people.set(person, (people.get(person) || 0) + 1);
      }
      // ... same for places, themes
    }

    summaries.push({
      carnet: carnet.id,
      entryDates: dates,
      peopleCounts: Object.fromEntries(people),
      placesCounts: Object.fromEntries(places),
      themeCounts: Object.fromEntries(themes),
    });
  }

  await writeFile('src/_data/carnet-summaries.json', JSON.stringify(summaries));
}
```

---

## File Changes Summary

### New Files
```
src/_original/{carnet}/_summary.md      # Editorial summary per carnet
src/_data/carnet-summaries.json         # Pre-computed aggregations
frontend/src/components/CalendarWidget.vue
frontend/src/components/CarnetCard.vue
frontend/src/components/YearCard.vue
scripts/generate-carnet-summaries.ts
```

### Modified Files
```
frontend/src/pages/cz/[carnet]/index.astro   # Enhanced carnet view
frontend/src/pages/cz/[year]/index.astro     # Expandable year view
frontend/src/pages/cz/[carnet]/[entry].astro # Calendar sidebar
frontend/src/lib/content.ts                  # Add summary loaders
```

---

## Open Questions — RESOLVED

1. **Calendar month navigation:** Carnet view shows next/prev month navigation buttons (not all months at once).

2. **Mobile UX:** Calendar is a popup that dismisses after selecting a date or clicking away.

3. **Cross-carnet calendar:** Yes — entry view calendar shows entries from adjacent carnets for continuity.

4. **Summary authoring:** Auto-generated after Research phase completes, when all daily entry summaries exist for the carnet.

5. **Localization:** Yes — summary files follow glossary file structure:
   - Paragraph IDs (`SUM.{carnet}.{seq}`)
   - Original at `src/_original/{carnet}/_summary.md`
   - Translations at `src/{lang}/{carnet}/_summary.md`
   - Translation format includes original text in comment above translated paragraph

---

## Inspiration / References

- [Historical diary websites with calendar navigation]
- [Roam Research daily notes calendar]
- [Notion database calendar view]
- [GitHub contribution graph] (for visual density)

---

*Last updated: 2026-02-03*

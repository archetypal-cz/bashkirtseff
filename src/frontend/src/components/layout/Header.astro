---
// Header component with navigation and locale switcher
import HeaderNav from './HeaderNav.vue';
import LocaleSwitcher from './LocaleSwitcher.vue';
import UnifiedMenu from './UnifiedMenu.vue';
import OfflineStatus from '../pwa/OfflineStatus.vue';
import { t as defaultT, createT, type SupportedLocale } from '../../i18n/astro';

interface Props {
  locale?: SupportedLocale;
}

const { locale } = Astro.props;
const t = locale ? createT(locale) : defaultT;
---

<header class="bg-sepia border-b border-ink/10 sticky top-0 z-40">
  <div class="max-w-6xl mx-auto px-4">
    <div class="flex items-center justify-between h-14 md:h-16">
      <!-- Logo / Title -->
      <a href="/" class="flex items-center gap-2 text-ink hover:text-accent transition-colors">
        <span id="site-title" class="text-lg md:text-xl font-semibold leading-tight" style="font-family: var(--font-serif);">
          {t('header.siteTitle')}
        </span>
      </a>

      <!-- Navigation (desktop) — Vue island for reactive locale -->
      <HeaderNav client:idle />

      <!-- Right side: Locale switcher + Login + Mobile Menu -->
      <div class="flex items-center gap-2 md:gap-4">
        <!-- Offline status indicator -->
        <OfflineStatus client:idle />

        <!-- UI Locale Switcher (CS/FR/EN) -->
        <LocaleSwitcher client:load />

        <!-- Unified Menu (settings + contents + filter + nav on mobile) -->
        <UnifiedMenu client:load />
      </div>
    </div>
  </div>
</header>

<script is:inline>
// Update site title from user's locale preference (static HTML is always Czech)
(function() {
  var titles = {
    cs: 'Deník Marie Bashkirtseff',
    en: 'Diary of Marie Bashkirtseff',
    fr: 'Journal de Marie Bashkirtseff',
    uk: 'Щоденник Марії Башкирцевої'
  };
  var locale = localStorage.getItem('ui-language');
  if (locale && titles[locale]) {
    var el = document.getElementById('site-title');
    if (el) el.textContent = titles[locale];
  }
})();
</script>

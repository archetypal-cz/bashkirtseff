---
import BaseLayout from './BaseLayout.astro';
import Header from '../components/layout/Header.astro';
import Footer from '../components/layout/Footer.astro';
import I18nPatch from '../components/I18nPatch.astro';

import BackToTop from '../components/reading/BackToTop.vue';
import InstallPrompt from '../components/pwa/InstallPrompt.vue';
import HistoryTracker from '../components/layout/HistoryTracker.vue';
import { contentPathToLocale } from '../i18n/astro';

interface Props {
  title?: string;
  description?: string;
  lang?: string;
  image?: string;
  type?: 'website' | 'article';
  canonicalUrl?: string;
  article?: {
    publishedTime?: string;
    modifiedTime?: string;
    author?: string;
  };
}

const { title, description, lang, image, type, canonicalUrl, article } = Astro.props;
const locale = lang ? contentPathToLocale(lang) : undefined;
---

<BaseLayout title={title} description={description} lang={lang} image={image} type={type} canonicalUrl={canonicalUrl} article={article}>
  <Header locale={locale} />

  <main class="flex-grow">
    <div class="max-w-4xl mx-auto px-4 py-8">
      <slot />
    </div>
  </main>

  <Footer locale={locale} />

  <!-- Back to top button (Vue island) -->
  <BackToTop client:visible />

  <!-- PWA install prompt (Vue island) -->
  <InstallPrompt client:idle />

  <!-- Reading history tracker (headless Vue island) -->
  <HistoryTracker client:load />

  <!-- I18n patching: runs after all content (incl. Footer) to translate data-t elements -->
  <I18nPatch />
</BaseLayout>

<!-- Theme/font-scale applied in BaseLayout <head> to prevent flash -->

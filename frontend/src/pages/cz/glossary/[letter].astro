---
import ReadingLayout from '../../../layouts/ReadingLayout.astro';
import { getGlossaryByLetter } from '../../../lib/content';

export function getStaticPaths() {
  const glossaryByLetter = getGlossaryByLetter();
  const letters = Array.from(glossaryByLetter.keys());

  return letters.map(letter => ({
    params: { letter: letter.toLowerCase() },
    props: {
      letter: letter.toUpperCase(),
      entries: glossaryByLetter.get(letter) || []
    }
  }));
}

const { letter, entries } = Astro.props;
const glossaryByLetter = getGlossaryByLetter();
const allLetters = Array.from(glossaryByLetter.keys()).sort();
---

<ReadingLayout title={`${letter} — Glosář`}>
  <div class="max-w-4xl mx-auto">
    <header class="mb-8">
      <nav class="mb-6 text-sm text-muted">
        <a href="/cz" class="hover:text-accent">Deník</a>
        <span class="mx-2">›</span>
        <a href="/cz/glossary" class="hover:text-accent">Glosář</a>
        <span class="mx-2">›</span>
        <span class="text-ink">{letter}</span>
      </nav>

      <h1 class="text-3xl font-normal text-ink mb-4" style="font-family: var(--font-serif);">
        {letter}
      </h1>
      <p class="text-sm text-muted">
        {entries.length} {entries.length === 1 ? 'položka' : entries.length < 5 ? 'položky' : 'položek'}
      </p>
    </header>

    <!-- Letter navigation -->
    <nav class="mb-8 flex flex-wrap gap-2">
      {allLetters.map(l => (
        <a
          href={`/cz/glossary/${l.toLowerCase()}`}
          class:list={[
            "w-8 h-8 flex items-center justify-center rounded text-sm font-medium transition-colors",
            l === letter
              ? "bg-accent text-white"
              : "bg-sepia text-ink hover:bg-accent hover:text-white"
          ]}
        >
          {l}
        </a>
      ))}
    </nav>

    <!-- Entries for this letter -->
    <div class="grid gap-3">
      {entries.map(entry => (
        <a
          href={`/cz/glossary/${entry.id}`}
          class="block p-4 bg-parchment rounded-lg border border-ink/10 hover:border-accent hover:shadow transition-all"
        >
          <div class="flex items-start justify-between gap-4">
            <div class="flex-1 min-w-0">
              <h3 class="text-lg text-ink font-medium truncate">
                {entry.name}
              </h3>
              {entry.type && (
                <span class="text-xs px-2 py-0.5 bg-sepia rounded text-muted mt-1 inline-block">
                  {entry.type}
                </span>
              )}
              {entry.summary && (
                <p class="text-sm text-muted mt-2 line-clamp-2">
                  {entry.summary}
                </p>
              )}
            </div>
            <svg class="w-5 h-5 text-muted flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </div>
        </a>
      ))}
    </div>

    {entries.length === 0 && (
      <div class="text-center py-12 text-muted">
        <p>Pro toto písmeno nejsou žádné položky.</p>
      </div>
    )}
  </div>
</ReadingLayout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

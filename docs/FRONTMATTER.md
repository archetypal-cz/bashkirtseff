# Frontmatter Format Documentation

## Overview

All diary entry files, glossary pages and summaries now support and in the future require [YAML frontmatter](https://jekyllrb.com/docs/front-matter/) at the beginning of the file. Frontmatter is a block of structured metadata (written in [YAML](https://www.redhat.com/en/topics/automation/what-is-yaml), a human-readable data format) placed between `---` markers at the top of a [Markdown](https://www.markdownguide.org/getting-started/) file. This consolidates information that was previously scattered throughout the file in comments.

## Static vs Calculated Attributes

The frontmatter contains two types of fields:

1. **Static Attributes**: Manually filled by researchers/editors
2. **Calculated Attributes**: Auto-generated by scripts

After creating or updating static attributes, run:

```bash
just update-frontmatter <carnet>          # updates all entries in a carnet
just update-frontmatter-entry <filepath>  # updates single entry
```

## Tooling

Frontmatter is handled by TypeScript utilities in the shared package (`@bashkirtseff/shared`). The core parser lives in `src/shared/src/parser/frontmatter.ts` and is used by both the frontend and CLI scripts.

Some frontmatter operations have [`just`](https://github.com/casey/just) commands (run `just` to see all available commands):

```bash
just check-frontmatter 001       # Check for missing/incomplete frontmatter in a carnet
just check-para-start 001        # Check for missing para_start fields
just check-para-start-all        # Coverage check across all carnets
```

For operations not yet wrapped in `just`, use the TypeScript scripts directly:

```bash
npx tsx src/scripts/sync-translation.ts 001              # Sync translations with originals
npx tsx src/scripts/scaffold-translation.ts 001 cz       # Generate translation templates
```

### Key behaviors

- File-level comments are moved to frontmatter `notes` array
- Paragraph-level comments remain with their paragraphs
- Calculated fields (age, word count, metrics) are auto-generated

## Frontmatter Structure

```yaml
---
# ========== STATIC ATTRIBUTES ==========
# (manually filled by researchers/editors)

# Basic metadata
date: 1873-01-11 # ISO date (extracted from filename)
type: daily_entry # entry type: daily_entry, merged_entry, continuation
carnet: "001" # 3-digit carnet number (000-105)
entry_id: "1873-01-11" # unique identifier

# Location and context
location: Nice # primary location (first place mentioned)
locations: [Nice, Rome] # all locations mentioned in entry

# Date information
dates:
  primary: "Samedi 11 janvier 1873" # full date header from entry
  merged: [] # for slash format entries like ["Vendredi 4", "Samedi 5"]

# Glossary entities mentioned
entities:
  people: [Howard_family, Mouton]
  places: [Nice, Promenade_des_Anglais]
  cultural: [Un_ballo_in_maschera]

# File-level notes (moved from comments)
notes:
  - "2025-12-07T16:00:00 RSR: Marie's location is Nice, France..."
  - "2025-12-07T10:00:00 LAN: Entry contains several period-specific..."

# Workflow metadata
workflow:
  research_complete: true
  linguistic_annotation_complete: true
  translation_complete: false
  editorial_review_complete: false
  conductor_approval: false
  last_modified: 2025-12-07T16:00:00
  modified_by: RSR

# Special flags
flags:
  empty_in_source: false # true if verified empty in raw carnet
  has_continuation: false # true if continues in next file

# ========== CALCULATED ATTRIBUTES ==========
# (auto-generated by scripts - leave empty when creating)

# Marie's age (calculated from birth date: 1860-11-24)
marie_age:
  years: 12
  months: 1
  days: 18

# Content metrics (calculated)
metrics:
  paragraph_count: 7 # count of unique paragraph IDs
  word_count: 156 # words in actual content (not comments)
  sentence_count_original: 6 # sentences in French text (headers + text + footnotes)
  sentence_count_translated: 0 # sentences in translation (0 if none)
  has_original: true # has French text
  has_translation: false # has Czech translation
  translation_version_count: 0 # number of translation versions
---
```

## Field Descriptions

### Basic Metadata

- **date**: [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) format date extracted from filename
- **type**: Entry type classification
  - `daily_entry`: Standard diary entry
  - `merged_entry`: Multiple dates merged (slash format)
  - `continuation`: Continuation from previous file
- **carnet**: Three-digit carnet identifier (000-105, matching Marie's original notebook numbering)
- **entry_id**: Unique identifier (usually same as date)

### Location Data

- **location**: Primary location mentioned (usually first)
- **locations**: Array of all locations mentioned

### Date Information

- **dates.primary**: Full date header as it appears in the entry
- **dates.merged**: For entries with slash format headers (empty days merged)

### Marie's Age

Calculated based on birth date 1860-11-24 (Marie's claimed date for consistency)

- **years, months, days**: Age breakdown at time of entry

### Content Metrics (all calculated)

- **paragraph_count**: Count of unique paragraph IDs
- **word_count**: Words in actual content (excluding comments)
- **sentence_count_original**: Sentences in French original text. Headers/date lines count as 1 sentence each. Footnotes are included. Abbreviations (M., Mme., etc.) are protected from false splits.
- **sentence_count_translated**: Sentences in translation (0 if no translation). Useful for comparing against original to catch missed/hallucinated content.
- **has_original**: Whether French text is present
- **has_translation**: Whether Czech translation exists
- **translation_version_count**: Number of translation versions

### Entities

Extracted from glossary links, categorized by type:

- **people**: Names of individuals
- **places**: Locations, cities, venues
- **cultural**: Books, operas, cultural references

### Notes

File-level notes moved from comments. Format:

```
"YYYY-MM-DDTHH:MM:SS ROLE: content"
```

Roles: RSR (researcher), LAN (linguistic annotator), TR (translator), etc.

### Workflow Tracking

Boolean flags for workflow stages:

- **research_complete**: RSR phase done
- **linguistic_annotation_complete**: LAN phase done
- **translation_complete**: Translation exists
- **editorial_review_complete**: Editor reviewed
- **conductor_approval**: Final approval
- **last_modified**: Timestamp of last change
- **modified_by**: Who made last change

### Special Flags

- **empty_in_source**: Entry verified as empty in raw carnet
- **has_continuation**: Entry continues in next file

## Usage Examples

### Check frontmatter coverage

```bash
just check-frontmatter 001              # Single carnet
just check-para-start-all               # All carnets
```

### Sync translations with updated originals

When the French source is edited (new research, corrected annotations), translations need to know. The sync script propagates changes without overwriting existing translations:

```bash
npx tsx src/scripts/sync-translation.ts 001              # Sync carnet 001
npx tsx src/scripts/sync-translation.ts 001 --dry-run    # Preview changes
npx tsx src/scripts/sync-translation.ts 001 --lang en    # Specific language
```

### Generate translation file scaffolds

Create empty translation files pre-populated with paragraph IDs, glossary tags, and the French text in comments — ready for a translator to fill in:

```bash
npx tsx src/scripts/scaffold-translation.ts 001 cz       # Czech scaffold for carnet 001
```

## Notes for Developers

- Frontmatter is always optional — the parser handles files with or without it
- When present, frontmatter values override values extracted from content
- All calculated fields (age, metrics) are recalculated on each render
- The shared package provides `parseFrontmatter()` and related utilities
- See `src/shared/CLAUDE.md` for the full shared package API
